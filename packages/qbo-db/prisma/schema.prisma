// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// QBO API Models (Database Schema) ------------------------------------------

// Chart of Accounts Entity
model Account {
  /// Primary key for this Account
  id String @id @unique

  /// IntuitEntity Columns ---------------------------------------------------
  /// Time this entity was created [Metadata->CreateTime]
  createTime      DateTime?
  /// Domain in which this entity belongs
  domain          String?
  /// Time this entity was last updated [Metadata->LastUpdatedTime]
  lastUpdatedTime DateTime?

  /// Account Columns --------------------------------------------------------
  /// Subtype of account
  accountSubType     String?
  /// Type of account
  accountType        String?
  /// Account number
  acctNum            String?
  /// Is this Account active?
  active             Boolean?
  /// Classification of this Account
  classification     AccountClassification?
  /// Currency reference name
  currencyRefName    String?
  /// Currency reference value
  currencyRefValue   String?
  /// Current balance (balance sheet accounts only)
  currentBalance     Float?
  /// Description of this Account
  description        String?
  /// Fully qualified name of this Account
  fullyQualifiedName String?
  /// Name of this Account
  name               String?
  /// Parent account ID if this is a subaccount [ParentRef.value]
  parentId           String?
  /// Is this a subaccount?
  subAccount         Boolean?

  /// Relationships ----------------------------------------------------------
  /// Child accounts of this Account
  childAccounts     Account[]          @relation("ParentChild")
  /// Journal Entry lines associated with this Account
  journalEntryLines JournalEntryLine[]
  /// Parent account of this Account
  parentAccount     Account?           @relation("ParentChild", fields: [parentId], references: [id])
  /// Transactions associated with this Account (from TransactionsWithSplits Report)
  transactions      Transaction[]

  @@map("accounts")
}

enum AccountClassification {
  Asset
  Equity
  Expense
  Liability
  Revenue
}

// Journal Entry Entity
model JournalEntry {
  /// Primary key for this JournalEntry
  id String @id @unique

  /// IntuitEntity Columns ---------------------------------------------------
  /// Time this entity was created [Metadata->CreateTime]
  createTime      DateTime?
  /// Domain in which this entity belongs
  domain          String?
  /// Time this entity was last updated [Metadata->LastUpdatedTime]
  lastUpdatedTime DateTime?

  /// Transaction Columns ----------------------------------------------------
  /// User entered private note for this transaction.
  privateNote String?
  /// Date of this JournalEntry (YYYY-MM-DD)
  txnDate     String?

  /// JournalEntry Columns ---------------------------------------------------
  /// Is this journal entry an adjustment?
  adjustment Boolean?

  /// Relationships ----------------------------------------------------------
  /// Lines associated with this JournalEntry
  lines JournalEntryLine[] @relation("JournalEntryLines")

  @@map("journal_entries")
}

// Journal Entry Line Entity
model JournalEntryLine {
  /// Secondary key for this JournalEntryLine (primary is journalEntryId)
  id String

  /// Line Columns -----------------------------------------------------------
  /// Amount for this line (always positive)
  amount      Float?
  /// Description of this line
  description String?

  /// JournalEntryLineDetail Columns -----------------------------------------
  /// Account ID for this line
  accountId   String?
  /// Posting type for this line (Debit or Credit)
  postingType PostingType?

  /// Relationships ----------------------------------------------------------
  /// Account this line is associated with
  account        Account?     @relation(fields: [accountId], references: [id], onDelete: SetNull)
  /// Journal Entry ID of the JournalEntry this line belongs to
  journalEntryId String       @map("journal_entry_id")
  /// Journal Entry this line belongs to
  journalEntry   JournalEntry @relation("JournalEntryLines", fields: [journalEntryId], references: [id], onDelete: Cascade)

  @@id([journalEntryId, id])
  @@map("journal_entry_lines")
}

enum PostingType {
  Debit
  Credit
}

// Transaction Entity (from TransactionsWithSplits Report)
model Transaction {
  /// Primary key for this Transaction
  // NOTE: THIS IS SYNTHETIC! - QBO API does not provide it, so it is not durable!
  id             BigInt  @id @unique @default(autoincrement())
  /// Transaction amount (nat_amount)
  amount         Float?
  /// Transaction date YYYY-MM-DD (txn_date)
  date           String?
  /// Document number (doc_num)
  documentNumber String?
  /// Memo or description of this transaction (memo)
  memo           String?
  /// Associated name (name)
  name           String?
  /// Transaction type (txn_type)
  type           String?

  /// Relationships ----------------------------------------------------------
  /// General Ledger Account associated with this transaction
  // (based on account_name first four characters)
  accountId String?
  account   Account? @relation(fields: [accountId], references: [id], onDelete: Cascade)

  @@index([date, accountId])
  @@map("transactions")
}
